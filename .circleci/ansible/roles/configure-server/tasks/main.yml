
  - name: "install python for Ansible."
    apt:
      pkg: 
        - python3
      state: latest
      update_cache: true

  - name: "install Node.js."
    apt:
      pkg: 
        - npm
      state: latest
      update_cache: true

  - name: "install PM2 for Node.js."
    shell:
      cmd: |
        npm install pm2 -g

  - name: "Persist environment variables."
    shell:
      cmd: |
        ENVIRONMENT=/home/ubuntu/.profile
        echo "export TYPEORM_CONNECTION=$TYPEORM_CONNECTION" >> $ENVIRONMENT
        echo "export TYPEORM_ENTITIES=$TYPEORM_ENTITIES" >> $ENVIRONMENT
        echo "export TYPEORM_HOST=$TYPEORM_HOST" >> $ENVIRONMENT
        echo "export TYPEORM_PORT=$TYPEORM_PORT" >> $ENVIRONMENT
        echo "export TYPEORM_USERNAME=$TYPEORM_USERNAME" >> $ENVIRONMENT
        echo "export TYPEORM_PASSWORD=$TYPEORM_PASSWORD" >> $ENVIRONMENT
        echo "export TYPEORM_DATABASE=$TYPEORM_DATABASE" >> $ENVIRONMENT
        echo "export TYPEORM_MIGRATIONS=$TYPEORM_MIGRATIONS" >> $ENVIRONMENT
        echo "export TYPEORM_MIGRATIONS_DIR=$TYPEORM_MIGRATIONS_DIR" >> $ENVIRONMENT
