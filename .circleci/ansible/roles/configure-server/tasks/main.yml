
  - name: "install python for Ansible."
    apt:
      pkg: 
        - python3
      state: latest
      update_cache: true

  - name: "install Node.js."
    apt:
      pkg: 
        - npm
      state: latest
      update_cache: true

  - name: "install PM2 for Node.js."
    shell:
      cmd: |
        npm install pm2 -g

  - name: "Persist environment variables."
    shell:
      cmd: |
        PROFILE=/home/ubuntu/.profile
        echo "export TYPEORM_CONNECTION=$TYPEORM_CONNECTION" >> $PROFILE
        echo "export TYPEORM_ENTITIES=$TYPEORM_ENTITIES" >> $PROFILE
        echo "export TYPEORM_HOST=$TYPEORM_HOST" >> $PROFILE
        echo "export TYPEORM_PORT=$TYPEORM_PORT" >> $PROFILE
        echo "export TYPEORM_USERNAME=$TYPEORM_USERNAME" >> $PROFILE
        echo "export TYPEORM_PASSWORD=$TYPEORM_PASSWORD" >> $PROFILE
        echo "export TYPEORM_DATABASE=$TYPEORM_DATABASE" >> $PROFILE
        echo "export TYPEORM_MIGRATIONS=$TYPEORM_MIGRATIONS" >> $PROFILE
        echo "export TYPEORM_MIGRATIONS_DIR=$TYPEORM_MIGRATIONS_DIR" >> $PROFILE

  - name: "Debug environment variables"
    shell:
      cmd: |
        echo "Environment variables:"
        PROFILE=/home/ubuntu/.profile
        cat $PROFILE
